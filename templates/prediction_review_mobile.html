<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>Groundtruth Studio - Quick Review</title>
    <link rel="icon" type="image/x-icon" href="/static/favicon.ico">
    <link rel="stylesheet" href="{{ static_v('css/prediction-review-mobile.css') }}">
</head>
<body>
    <!-- Screen 1: Queue Screen -->
    <div id="queue-screen" class="screen">
        <div class="queue-header">
            <div class="queue-top-bar">
                <a href="/" class="back-button" id="queue-back">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 18l-6-6 6-6"/>
                    </svg>
                </a>
                <h1 class="queue-title">Review Queue</h1>
                <button class="history-button" id="history-button">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                    </svg>
                </button>
                <button class="grouped-toggle active" id="grouped-toggle" title="Group similar detections">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/>
                        <rect x="3" y="14" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/>
                    </svg>
                </button>
            </div>
            <div class="queue-summary" id="queue-summary">
                <span id="pending-count">0</span> pending across <span id="video-count">0</span> videos
            </div>
            <div class="filter-chips-row">
                <div class="filter-chips">
                    <button class="filter-chip active" data-filter="all">All <span class="filter-count-badge" data-count-filter="all"></span></button>
                    <button class="filter-chip" data-filter="vehicles">Vehicles <span class="filter-count-badge" data-count-filter="vehicles"></span></button>
                    <button class="filter-chip" data-filter="people">People <span class="filter-count-badge" data-count-filter="people"></span></button>
                    <button class="filter-chip" data-filter="classify">Classify <span class="filter-count-badge" data-count-filter="classify"></span></button>
                    <button class="filter-chip" data-filter="conflicts" id="conflicts-chip">Conflicts <span class="filter-count-badge" data-count-filter="conflicts"></span></button>
                    <button class="filter-chip" data-filter="cross_camera">Cross-Camera <span class="filter-count-badge" data-count-filter="cross_camera"></span></button>
                    <button class="filter-chip" data-filter="clusters">Clusters <span class="filter-count-badge" data-count-filter="clusters"></span></button>
                    <button class="filter-chip" data-filter="plates">Plates <span class="filter-count-badge" data-count-filter="plates"></span></button>
                    <button class="filter-chip" data-filter="boat_reg">Boat Reg <span class="filter-count-badge" data-count-filter="boat_reg"></span></button>
                    <button class="filter-chip" data-filter="other">Other <span class="filter-count-badge" data-count-filter="other"></span></button>
                </div>
                <div class="confidence-filter-wrap">
                    <select id="confidence-filter" class="confidence-filter">
                        <option value="all">Confidence: All</option>
                        <option value="certain">Certain (&ge;99%)</option>
                        <option value="very_high">Very High (&ge;90%)</option>
                        <option value="high">High (&ge;80%)</option>
                        <option value="moderate">Moderate (&ge;60%)</option>
                        <option value="low">Low (&lt;60%)</option>
                    </select>
                </div>
                <div class="camera-filter-wrap">
                    <select id="camera-filter" class="confidence-filter">
                        <option value="all">Camera: All</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="video-list" id="video-list">
            <!-- All Videos card -->
            <div class="video-card" data-video-id="all" id="all-videos-card">
                <div class="video-card-thumbnail">
                    <svg width="56" height="56" viewBox="0 0 56 56" fill="none">
                        <rect width="56" height="56" rx="8" fill="#262626"/>
                        <path d="M28 14v28M14 28h28" stroke="#0D9488" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </div>
                <div class="video-card-info">
                    <div class="video-card-title">All Videos</div>
                    <div class="video-card-subtitle" id="all-videos-subtitle">0 predictions pending</div>
                </div>
                <svg class="progress-ring" width="32" height="32">
                    <circle cx="16" cy="16" r="14" stroke="#262626" stroke-width="2.5" fill="none"/>
                    <circle cx="16" cy="16" r="14" stroke="#0D9488" stroke-width="2.5" fill="none"
                            stroke-dasharray="87.96" stroke-dashoffset="87.96" stroke-linecap="round"
                            transform="rotate(-90 16 16)" class="progress-ring-fill"/>
                </svg>
            </div>

            <!-- Video cards will be inserted here by JS -->
        </div>
    </div>

    <!-- Screen 2: Review Screen -->
    <div id="review-screen" class="screen hidden">
        <div class="review-header">
            <button class="back-button" id="review-back">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <h2 class="review-title" id="review-video-title">Video Title</h2>
            <button class="speed-mode-toggle" id="speed-mode-toggle" title="Speed mode: skip rejection feedback">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/>
                </svg>
                <span class="speed-label">Speed: OFF</span>
            </button>
            <button class="speed-mode-toggle" id="pending-toggle" title="Include pending detections in classify queue" style="display:none;">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10"/><path d="M12 6v6l4 2"/>
                </svg>
                <span class="pending-label">Pending: OFF</span>
            </button>
            <div class="menu-wrapper">
                <button class="menu-button" id="review-menu">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="5" r="1.5"/>
                        <circle cx="12" cy="12" r="1.5"/>
                        <circle cx="12" cy="19" r="1.5"/>
                    </svg>
                </button>
                <div class="menu-dropdown hidden" id="review-menu-dropdown">
                    <button class="menu-item" id="menu-hard-refresh">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 105.69-9.31L1 10"/></svg>
                        Hard Refresh
                    </button>
                    <button class="menu-item" id="menu-reset-zoom">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
                        Reset Zoom
                    </button>
                    <button class="menu-item" id="menu-copy-debug">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="9" y="9" width="13" height="13" rx="2"/><path d="M5 15H4a2 2 0 01-2-2V4a2 2 0 012-2h9a2 2 0 012 2v1"/></svg>
                        Copy Debug Info
                    </button>
                    <button class="menu-item" id="menu-ai-feedback">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z"/></svg>
                        Feedback for AI
                    </button>
                </div>
            </div>
        </div>

        <div class="card-stage">
            <div id="card-container">
                <!-- Cards will be inserted here by JS -->
            </div>
        </div>

        <div class="metadata-strip" id="metadata-strip">
            <span class="metadata-label" id="pred-class">Object</span>
            <span class="metadata-confidence" id="pred-confidence">95%</span>
            <span class="metadata-model" id="pred-model">YOLOv8</span>
        </div>
        <div class="review-guidance" id="review-guidance"></div>

        <div class="action-zone">
            <div class="card-position-dots" id="position-dots">
                <div class="dot"></div>
                <div class="dot active"></div>
                <div class="dot"></div>
            </div>

            <div class="action-buttons">
                <button class="action-button reject-button" id="reject-button">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>

                <button class="action-button skip-button" id="skip-button">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round">
                        <path d="M5 12h14M13 5l7 7-7 7"/>
                    </svg>
                </button>

                <button class="action-button approve-button" id="approve-button">
                    <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M20 6L9 17l-5-5"/>
                    </svg>
                </button>

                <button class="action-button bad-bbox-button" id="bad-bbox-button" title="Mark as bad bounding box (valid detection, poor placement)">
                    <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                        <rect x="3" y="3" width="18" height="18" rx="2"/>
                        <path d="M9 9l6 6M15 9l-6 6"/>
                    </svg>
                </button>
            </div>

            <div class="progress-bar">
                <div class="progress-track">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
            </div>

            <div class="action-footer">
                <button class="undo-button" id="undo-button">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 7v6h6"/><path d="M3 13a9 9 0 1 0 2.6-6.4L3 9"/>
                    </svg>
                    Undo
                </button>
                <div class="review-count" id="review-count">0/0</div>
            </div>
        </div>

        <!-- Edge glow indicators -->
        <div class="edge-glow edge-glow-left" id="glow-left"></div>
        <div class="edge-glow edge-glow-right" id="glow-right"></div>
    </div>

    <!-- Rejection Feedback Bottom Sheet -->
    <div id="reject-sheet" class="bottom-sheet">
        <div class="sheet-grabber"></div>
        <h3 class="sheet-heading">What was wrong?</h3>

        <div class="rejection-reasons">
            <button class="reason-chip" data-reason="wrong_location">Wrong location</button>
            <button class="reason-chip" data-reason="bad_size">Bad size</button>
            <button class="reason-chip" data-reason="wrong_class">Wrong class</button>
            <button class="reason-chip" data-reason="false_positive">False positive</button>
            <button class="reason-chip" data-reason="missed_detection">Missed detection</button>
            <button class="reason-chip" data-reason="other">Other</button>
        </div>

        <div class="other-input-container hidden" id="other-input-container">
            <input type="text" class="other-input" id="other-input" placeholder="Describe the issue..." maxlength="100">
        </div>

        <div class="sheet-actions">
            <button class="sheet-undo-button" id="sheet-undo-button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 7v6h6"/><path d="M3 13a9 9 0 1 0 2.6-6.4L3 9"/>
                </svg>
                Undo &amp; go back
            </button>
            <button class="skip-feedback-button" id="skip-feedback">Skip feedback</button>
            <button class="done-button" id="done-feedback">Done</button>
        </div>
    </div>

    <!-- Screen 3: Summary Screen -->
    <div id="summary-screen" class="screen hidden">
        <div class="summary-container">
            <div class="completion-ring-container">
                <svg class="completion-ring" width="160" height="160" viewBox="0 0 160 160">
                    <circle cx="80" cy="80" r="70" stroke="#262626" stroke-width="8" fill="none"/>
                    <circle cx="80" cy="80" r="70" stroke="url(#gradient-ring)" stroke-width="8" fill="none"
                            stroke-dasharray="439.82" stroke-dashoffset="439.82" stroke-linecap="round"
                            transform="rotate(-90 80 80)" class="completion-ring-fill" id="completion-ring-fill"/>
                    <defs>
                        <linearGradient id="gradient-ring" x1="0%" y1="0%" x2="100%" y2="100%">
                            <stop offset="0%" stop-color="#2DD4BF"/>
                            <stop offset="100%" stop-color="#0D9488"/>
                        </linearGradient>
                    </defs>
                </svg>
                <div class="completion-count" id="completion-count">0</div>
            </div>

            <div class="completion-subtitle">predictions reviewed</div>

            <div class="summary-stats">
                <div class="stat-card stat-approved">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M20 6L9 17l-5-5"/>
                        </svg>
                    </div>
                    <div class="stat-value" id="approved-count">0</div>
                    <div class="stat-label">Approved</div>
                </div>

                <div class="stat-card stat-rejected">
                    <div class="stat-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                            <path d="M18 6L6 18M6 6l12 12"/>
                        </svg>
                    </div>
                    <div class="stat-value" id="rejected-count">0</div>
                    <div class="stat-label">Rejected</div>
                </div>
            </div>

            <div class="stat-card stat-reclassified" style="display:none">
                <div class="stat-icon" style="color:#f59e0b">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5">
                        <path d="M17 1l4 4-4 4"/><path d="M3 11V9a4 4 0 0 1 4-4h14"/>
                        <path d="M7 23l-4-4 4-4"/><path d="M21 13v2a4 4 0 0 1-4 4H3"/>
                    </svg>
                </div>
                <div class="stat-value stat-count">0</div>
                <div class="stat-label">Reclassified</div>
            </div>
            <div class="skipped-line" id="skipped-line">
                <span id="skipped-count">0</span> skipped
            </div>

            <div class="summary-actions">
                <button class="summary-button undo-last-button" id="summary-undo-button">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M3 7v6h6"/><path d="M3 13a9 9 0 1 0 2.6-6.4L3 9"/>
                    </svg>
                    Undo Last
                </button>
                <button class="summary-button primary-button" id="back-to-queue">Back to Queue</button>
                <button class="summary-button secondary-button" id="review-skipped">Review Skipped</button>
            </div>
        </div>
    </div>

    <!-- Screen 4: Review History -->
    <div id="history-screen" class="screen hidden">
        <div class="history-header">
            <button class="back-button" id="history-back">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <h2 class="history-title">Review History</h2>
        </div>
        <div class="history-filters">
            <button class="filter-chip active" data-history-filter="all">All</button>
            <button class="filter-chip" data-history-filter="approved">Approved</button>
            <button class="filter-chip" data-history-filter="rejected">Rejected</button>
            <button class="filter-chip" data-history-filter="classified">Classified</button>
        </div>
        <div class="history-subfilters" id="history-subfilters" style="display:none">
            <select class="history-classification-select" id="history-classification-select">
                <option value="">All classifications</option>
            </select>
        </div>
        <div class="history-list" id="history-list">
            <!-- History items rendered by JS -->
        </div>
    </div>

    <div id="ai-feedback-modal" class="feedback-modal hidden">
        <div class="feedback-modal-content">
            <div class="feedback-modal-header">
                <h3>Feedback for AI</h3>
                <button class="feedback-close-btn" id="feedback-close">&times;</button>
            </div>
            <div class="feedback-modal-body">
                <p class="feedback-context" id="feedback-context"></p>
                <textarea id="feedback-text" placeholder="Leave notes, corrections, or suggestions..." rows="4"></textarea>
            </div>
            <div class="feedback-modal-footer">
                <button class="feedback-cancel-btn" id="feedback-cancel">Cancel</button>
                <button class="feedback-submit-btn" id="feedback-submit">Submit</button>
            </div>
        </div>
    </div>

    <script src="{{ static_v('js/prediction-review-mobile.js') }}"></script>
</body>
</html>
